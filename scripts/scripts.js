(function(){"use strict";angular.module("jmxRtMonApp",["ngCookies","ngResource","ngSanitize"]).config(["$routeProvider",function(a){return a.when("/beans",{templateUrl:"views/beans.html",controller:"BeansCtrl",tabname:"beans",reloadOnSearch:!1}).when("/plots",{templateUrl:"views/plots.html",controller:"PlotsCtrl",tabname:"plots",reloadOnSearch:!1}).when("/faq",{templateUrl:"views/faq.html",tabname:"faq"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl",tabname:"home"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$route",function(a,b){return a.$route=b}])}).call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("MainCtrl",["$scope","$location","ConfigService","JmxRefresher",function(a,b,c,d){return a.$on("$routeChangeSuccess",function(){return d.disconnect()}),a.address=c.settings.url,a.goToAddress=function(){return c.set(c.URL_KEY,a.address),b.path("/beans"),b.search({q:c.serialize()})},a.clearData=function(){return a.address="",c.setToDefault()},a.MainCtrl=a,a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("BeansCtrl",["$scope","JmxRefresher","ConfigService","$location",function(a,b){var c,d;return a.beans=[],a.tree={},a.displayTree={expanded:!0,name:"Beans",children:[]},a.$on("JmxRefresher.data_updated",function(){var e;return a.beans=_(b.beans).pluck("name"),_(a.beans).each(function(c){var d,e,f,g;return g=c.split(":"),f=g[0],e=g[1],a.tree[f]||(a.tree[f]={}),a.tree[f][e]||(a.tree[f][e]={}),d=_(b.beans).findWhere({name:c}),a.tree[f][e]=d}),e=c(a.tree,0),d(a.displayTree,{name:"Beans",children:e}),a.$apply()}),d=function(a,b){return a.name!==b.name&&raise("name mismatch"),a.value=b.value,_(b.children).each(function(b){var c;return c=_(a.children).findWhere({name:b.name}),c?d(c,b):a.children.push(b)})},c=function(a,b,d){var e,f,g,h;e=[],f=d,2===b&&a.name&&(f=a.name);for(g in a)h=a[g],h instanceof Object?e.push({name:g,children:c(h,b+1,""+f+"|"+g)}):e.push({name:g,value:h,path:""+f+"|"+g});return e}}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("PlotsCtrl",["$scope","JmxRefresher","$location","ConfigService","PlotStore",function(a,b,c,d,e){return a.$watch("ConfigService.settings",function(){return a.plots=d.get(d.PLOTS_KEY)}),a.$on("JmxRefresher.data_updated",function(a,b){var c;return c=d.get(d.PLOTS_KEY),_(c).each(function(a){var c,d,f,g,h,i;return h=a.key,i=h.split("|"),d=i[0],g=i[1],c=_(b).find(function(a){return a.name===d}),f=c[g],e.addDatapoint(h,f)})}),a.removePlot=function(b){var c;return c=_(a.plots).indexOf(b),c>-1&&a.plots.splice(c,1),a.$emit("ConfigService.request_location_update")},a.PlotsCtrl=a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("PlotCtrl",["$scope","JmxRefresher","$location","ConfigService","PlotStore",function(a,b,c,d,e){return a.formattedPath=function(){var b;return b=a.plot.key,b.match(/^Hadoop:service=/)&&(b=b.replace("Hadoop:service=",""),b=b.replace(",name=","."),b=b.replace("|",".")),a.plot.derivative_mode&&(b="Î” "+b),b},a.toggleDetails=function(){return a.plot.show_details=!a.plot.show_details,a.$emit("ConfigService.request_location_update")},a.titleForToggleDetails=function(){var b;return b=a.plot.show_details,b?"Hide Details":"Show Details"},a.toggleDerivative=function(){return a.plot.derivative_mode=!a.plot.derivative_mode,a.$emit("ConfigService.request_location_update")},a.titleForToggleDerivative=function(){var b;return b=a.plot.derivative_mode,b?"Plot Absolute":"Plot Derivative"},a.boundsExist=function(){return a.plot.minY||0===a.plot.minY||a.plot.maxY||0===a.plot.maxY},a.updatefn=_.debounce(function(){return a.$emit("ConfigService.request_location_update")},1e3),a.$watch("plot.minY + plot.maxY",function(){return a.updatefn()}),a.titleForToggleBounds=function(){return a.boundsExist()?"Remove Y Bounds":"Pin Y Axis"},a.toggleBounds=function(){return a.boundsExist()?(delete a.plot.minY,delete a.plot.maxY):(a.plot.minY=0,a.plot.maxY=0/0),a.$emit("ConfigService.request_location_update")},a.mostRecentValue=function(){var b;return b=e.getLatestDatapoint(a.plot.key),b?b.y:0},a.PlotCtrl=a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("NavCtrl",["$scope","$location","ConfigService",function(a,b,c){return a.goToBookmarkableUrl=function(a){return console.log("Go to",a),b.path("/"+a),b.search({q:c.serialize()})},a.goToUrl=function(a){return console.log("Go to",a),b.path("/"+a)}}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("ConfigCtrl",["$scope","ConfigService","$location","$timeout",function(a,b){return a.settings=b.settings,a.copy={},a.synchronized=!1,a.$watch("settings",function(){return angular.copy(a.settings,a.copy),a.synchronized=!0},!0),a.$watch("copy",function(){return a.synchronized=angular.equals(a.settings,a.copy)},!0),a.commit=function(){return console.log("Sync"),b.setTo(a.copy)},a.ConfigCtrl=a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("RefreshCtrl",["$scope","JmxRefresher","$location","ConfigService","PlotStore",function(a,b,c,d){return a.JmxRefresher=b,a.$on("$routeChangeSuccess",function(){return console.log("Refresh?",a.once),d.deserialize(),a.once?(b.disconnect(),b.fetch_data()):b.connect()}),a.RefreshCtrl=a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").factory("JmxRefresher",["$timeout","$rootScope","ConfigService",function(a,b,c){var d;return d={},d.error="Still waiting for response... Server could be slow or unreachable.",d.connected=!1,d.url=function(){return c.get(c.URL_KEY)},d.beans=[],d.update_interval=function(){return c.get(c.REFRESH_PERIOD_KEY)},d.fetch_data=function(){return jQuery.getJSON(""+d.url()+"?callback=?",function(a){return a?(d.error=void 0,d.beans=a.beans,b.$broadcast("JmxRefresher.data_updated",a.beans)):void 0}).fail(function(){return console.log("ERROR"),d.error="Could not connect to '"+d.url()+"'. Make sure the location is reachable and returns a json document.",b.$apply()})},d.connect=function(){var b;return d.connected?(console.log("Already connected"),void 0):(d.connected=!0,b=function(){return d.fetch_data(),a(function(){return d.connected?b():void 0},d.update_interval())},b())},d.disconnect=function(){return d.connected=!1},d}])}.call(this),function(){angular.module("jmxRtMonApp").factory("ConfigService",["$timeout","$rootScope","$location",function(a,b,c){var d;return d={},d.REFRESH_PERIOD_KEY="refresh",d.URL_KEY="url",d.PLOTS_KEY="plots",d.settings={},d.defaults={refresh:200,seconds_to_remember:40,url:"",plots:[],note:""},b.$on("ConfigService.request_location_update",function(){return console.log("Got config_changed event, updating $location"),c.search({q:d.serialize()}),b.$broadcast("ConfigService.location_updated")}),d.set=function(a,b){return d.settings[a]=b},d.get=function(a){return d.settings[a]},d.setToDefault=function(){return console.log("Reset Settings to Default"),d.setTo(d.defaults)},d.setTo=function(a){return angular.copy(a,d.settings),b.$emit("ConfigService.request_location_update")},d.serialize=function(){return encodeURIComponent(JSON.stringify(d.settings))},d.deserialize=function(){var a,b,e;return e=JSON.parse(decodeURIComponent(c.search().q)),a=angular.copy(d.defaults),b=angular.extend(a,e),angular.copy(b,d.settings)},d.isConfigured=function(){var a,b;return(a=d.settings)?(b=a.url,b?""!==b:!1):!1},angular.copy(d.defaults,d.settings),d}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").factory("PlotStore",["$timeout","$rootScope","ConfigService",function(){var a,b;return b={},b.plots={},a=100,b.addDatapoint=function(c,d){var e,f;return b.plots[c]||(b.plots[c]={series:[]}),f={x:new Date,y:d},e=b.plots[c].series,e.push(f),e.length>a?e.shift():void 0},b.getLatestDatapoint=function(a){var c;return c=b.plots[a],c?c.series[c.series.length-1]:null},b.getLatestDifference=function(a){var c,d,e,f;return(f=b.plots[a])?(e=f.series,e.length>2?(c=e[e.length-1],d=e[e.length-2],{x:c.x,y:c.y-d.y}):null):null},b}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").directive("plot",["PlotStore","ConfigService","$rootScope",function(a,b){return{restrict:"E",replace:!0,scope:{settings:"="},template:'<div class="plot">\n	<div>\n		<canvas width="800px" height="200px" class="plot_canvas"></canvas>\n	</div>\n</div>',controller:["$scope",function(){}],link:function(c,d){var e,f;return e=d.find(".plot_canvas")[0],f=new SmoothieChart({maxValueScale:1.2,interpolation:"linear",millisPerPixel:1e3*b.settings.seconds_to_remember/e.width}),f.streamTo(e,300),c.ts=new TimeSeries,c.PlotStore=a,c.$watch("PlotStore",function(){var b;return b=null,(b=c.settings.derivative_mode?a.getLatestDifference(c.settings.key):a.getLatestDatapoint(c.settings.key))?c.ts.append(b.x.getTime(),b.y):void 0},!0),c.$watch(function(){return b.settings.seconds_to_remember},function(){return f.options.millisPerPixel=1e3*b.settings.seconds_to_remember/e.width}),c.$watch("settings.maxY + settings.minY",function(){return c.settings?(console.log("Bounds changed",c.settings.minY,c.settings.maxY),f.options.minValue=c.settings.minY,f.options.maxValue=c.settings.maxY):void 0}),c.$watch("settings.derivative_mode",function(){return console.log("Deriv mode changed"),f.removeTimeSeries(c.ts),c.ts=new TimeSeries,f.addTimeSeries(c.ts,{strokeStyle:"rgb(0, 255, 0)",linewidth:3}),c.settings.minY||0===c.settings.minY?void 0:f.options.minValue=c.settings.derivative_mode?void 0:0})}}}])}.call(this),function(){angular.module("jmxRtMonApp").directive("tree",["$compile",function(a){return{restrict:"E",scope:{model:"="},template:'<span class="pointable">\n  <span ng-click="model.expanded = !model.expanded">\n    <span ng-show="model.children && !model.expanded"> <i class="fa fa-caret-right"></i> </span>\n    <span ng-show="model.children &&  model.expanded"> <i class="fa fa-caret-down"></i> </span>\n    <span ng-show="model.children">\n      {{model.name}}\n    </span>\n    <span ng-show="!model.children">\n      <prototype model="model"></prototype>\n    </span>\n  </span>\n  <div style="padding-left: 15px" ng-repeat="child in model.children" ng-show="model.expanded">\n    <tree model="child"></tree>\n  </div>\n</span>',compile:function(b){var c,d;return d=b.contents().remove(),c=void 0,function(b,e){return c||(c=a(d)),c(b,function(a){return e.append(a)})}}}}])}.call(this),function(){angular.module("jmxRtMonApp").directive("prototype",["$compile","ConfigService","PlotStore",function(a,b){return{restrict:"E",scope:{model:"="},template:"<span ng-class=\"{'label-primary': isSelected(), 'label-default': is_numeric, label: is_numeric}\" ng-click=\"toggle()\">\n	{{model.name}} = <code>{{model.value}}</code>\n</span>",link:function(a){return"number"==typeof a.model.value&&(a.is_numeric=!0),a.isSelected=function(){var c;return a.is_numeric?(c=b.get(b.PLOTS_KEY),_(c).findWhere({key:a.model.path})):void 0},a.toggle=function(){var c,d,e,f;return a.is_numeric?(f=b.get(b.PLOTS_KEY),e=a.model.path,c=_(f).findWhere({key:e}),c?(d=f.indexOf(c),d>-1?f.splice(d,1):void 0):f.push({key:e})):void 0}}}}])}.call(this),function(){angular.module("jmxRtMonApp").directive("plotkey",["$compile","ConfigService","PlotStore",function(){return{restrict:"E",scope:{name:"="},template:"{{short_name}}",link:function(a){return a.$watch("name",function(){return a.short_name=a.name.split("|")[1]})}}}])}.call(this);